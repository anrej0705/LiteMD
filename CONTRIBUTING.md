## Список рекомендаций, облегчающих процесс внедрения дополнительных фич(или багов) в проект

**Данные рекомендации составлены для унификации некоторых модулей программы и облегчения чтения и анализа кода. Соблюдение рекомендаций сильно облегчает и ускоряет процесс
принятия решения по внедрению вашей ветки**

Данное руководство будет дополняться по мере появления новых возможностей/предложений

<hr>

### Интерфейс

#### Языки и локализация

В LiteMD работает собственная система динамической смены языка приложения(не QML!), в основе которой находятся события. Инициатором смены языка является событие `APP_EVENT_UI_UPDATE_EVENT`,
имеющее идентификатор 1033. Событие перехватывается фильтром `bool appSettings::eventFilter`, расположенным в файле appSetting_ui.cpp, который в свою очередь запускает
очередь из событий с идентификаторами, начинающимися с ID=1034, для каждого из которых имеется собственный фильтр, настроенный на данный ID. Полный список идентификаторов 
и их наименований можно увидеть в таблице ниже

Таблица 1. Список идентификаторов событий смены языка(на момент версии 0.1.7.1006)
|ID|Наименование события|Цель|Описание|
|--|--------------------|----|--------|
|33|APP_EVENT_UI_UPDATE_EVENT|appSettings_ui.cpp|Событие запускает процесс смены языка приложения|
|34|APP_EVENT_LiteMD_UPDATE_EVENT|LiteMD.cpp|Интерфейс главного окна|
|35|APP_EVENT_mdEditor_UPDATE_EVENT|mdEditor.cpp|Интерфейс редактора|
|36|APP_EVENT_mdScreen_UPDATE_EVENT|mdScreen.cpp|Интерфейс окна рендера|
|37|APP_EVENT_GuiDownloader_UPDATE_EVENT|GuiDownloader.cpp|Интерфейс модуля загрузчика|
|38|APP_EVENT_dialogBoxes_UPDATE_EVENT|dialogBoxes.cpp|Диалоговые окна|
|39|APP_EVENT_appSettings_UPDATE_EVENT|appSettings.cpp|Окно настроек|
|40|APP_EVENT_tab_basic_UPDATE_EVENT|tab_basic.cpp|Вкладка "Основные"(вырезано)|

Диапазон ИД событий смены языка на данный момент `1034...1150`

Если твой форк предполагает создание нового окна, содержащего какой либо текст или элементы интерфейса с текстом(кнопки, флажки, поля и т.д) то для облегчения
процесса мержа в ветку нужно придерживаться следующих правил:

1. Любой элемент интерфейса должен быть образован от QWidget или QObject так как интерфейс работает на Qt5
2. Любой элемент интерфейса должен быть создан как указатель и помещён в поле private/protected класса
3. При инициализации элемента, если его содержимое предполагает наличие текста, обязательно нужно использовать конструктцию `QObject::tr("const char")` либо `tr("const char")`, пример в коде ниже:

   ```
   //Объявление в хидере
   private:
     QPushButton* settings_button; //Кнопка "Настройки"
   
   //Инициализация в конструкторе
   settings_button = new QPushButton(QObject::tr("Settings"));
   ```
4. Идентификатор события для твоего окна должен быть типа `#define` и начинаться с префикса `APP_EVENT_`, например `#define APP_EVENT_net_settings_update 48` или `#define APP_EVENT_NET_SETTINGS_UPDATE 48`
5. Идентификатор события для твоего окна должен быть помещен в файл *global_definitions.h* в раздел "События смены языка"
6. ИД события не должен совпадать с уже имеющимися ИД, каждое событие уникально по своему
7. Для фильтра события, и метода, который вызывает фильтр должен быть отдельный файл с суффиксом `_ui`, например `net_setting_ui.cpp`
8. Фильтр событий *всегда* должен возращать `true`, если он получил событие, на которое настроен, в ином случае должен передавать событие дальше по коду. Образец фильтра в листинге ниже
   ```
   #include "LiteMD.h"
   #include "global_definitions.h"
   
   bool LiteMD::eventFilter(QObject* pobj, QEvent* p_event)
   {
   	if (p_event->type() == static_cast<QEvent::Type>(QEvent::User + APP_EVENT_LiteMD_UPDATE_EVENT))
   	{
   		update_ui();
   		return 1;
   	}
   	return QWidget::eventFilter(pobj, p_event);
   }
   
   void LiteMD::update_ui()
   {
   	editorWindow->setTitle(tr("Editor"));
    //Здесь выполняется код смены языка
   }
   ```
9. Метод, выполняющий смену языка в твоём виджете должен иметь название `update_ui` как из примера выше. Без исключений
10. Файл с фильтром должен быть помещён в подраздел *Динамический перевод* раздела *Модули* проекта MSVC

#### Стилизация интерфейса

Весь интерфейс программы пишется напрямую из кода. В данный момент .ui шаблоны не используются, и не запланированы к использованию. Весь интерфейс настраивается из кода.

Если предполагается добавление новых опций в окно настроек то все подсказки нужно размещать слева а флажки, кнопки, поля - справа. Высота для элементов задана в global_definitions.h
и должна быть задана через параметр `my_widget->setFixedHeight(SETTINGS_HEIGH);`. Не допускается задание собственных значений без острой необходимости

#### Перевод на другие языки

Весь необходимый для перевода контент находится в файлах .ts папки ./loc. Для перевода рекомендуется использовать QT Linguist. По желанию, перевод можно
дополнить комментарием переводчика. В текущий момент принимаются практически любые языки, кроме языков стран бывшего СССР, для которого язык приложения 
задан как русский, например: русский(Беларусь), русский(Украина), русский (Казахстан), русский (Молдова), русский (Латвия) и т.д. Пул реквесты с 
локализацией для данных регионов имеют самый низкий приоритет и могут быть отклонены, в таком случае причина отклонения будет сообщена дополнительно.

<hr>

### Бекенд

Рекомендации по коду для бекенда

#### Комментирование кода

Для лучшего понимания какая строка или часть кода за что отвечает рекомендуется написание комментариев к коду. Разработчик русскоязычный и его основным языком является
русский. При написании комментариев на другом языке, рекомендуется продублировать комментарий на русском, можно через переводчик(поправим после мержа). Все файлы должны
быть сохранены в кодировке UTF-8, кодировка Cp1251 недопустима так как GitHub искажает кириллицу в данной кодировке

#### Рендер текста

В LiteMD есть собственный github-like рендер текста, который показывает как визуально будет выглядеть файл при просмотре на GitHub. В будущем будет введена
возможность экспорта отрендеренного файла в PDF и/или вывод его на печать. Перед рендером текст обрабатывается - теги переводятся в аналоги формата HTML/RichText.
Порядок обработки в данный момент такой:

1. Обрабатываются знаки формата `/n/n`(двойной перенос строк), заменяются на тег <BR>
2. Фильтруются повреждённые теги, чтобы избежать ложного срабатывания
3. Обрабатываются теги ссылок Markdown и заменяются конструкцией `<a href="url">url</a>`
4. Обрабатываются теги форматирования текста и заменяются эквивалентными HTML тегами `<B>`, `<I>`, `<U>` и т.д
5. Массив с текстом чистится от мусора и выводится на рендер

В процессе разработки эта цепочка будет удлиняться по мере введения новых фич
